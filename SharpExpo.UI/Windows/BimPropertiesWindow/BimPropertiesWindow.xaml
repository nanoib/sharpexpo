<Window x:Class="SharpExpo.UI.Windows.BimPropertiesWindow.BimPropertiesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SharpExpo.UI.Windows.BimPropertiesWindow"
        xmlns:vm="clr-namespace:SharpExpo.UI.ViewModels"
        mc:Ignorable="d"
        Title="BIM Ð¡Ð²Ð¾Ð¹ÑÑ‚Ð²Ð°" Height="600" Width="400"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Closing="BimPropertiesWindow_Closing">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ÐŸÐ¾Ð¸ÑÐºÐ¾Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
        <Grid Grid.Row="0" Background="#F0F0F0" Margin="0,0,0,1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" 
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Margin="5"
                     Padding="5,3"
                     VerticalContentAlignment="Center">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TextBox">
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Background="White">
                                        <Grid>
                                            <ScrollViewer x:Name="PART_ContentHost" Margin="5,3"/>
                                            <TextBlock Text="ÐŸÐ¾Ð¸ÑÐº" 
                                                       Foreground="#999999" 
                                                       Margin="10,3,5,3"
                                                       VerticalAlignment="Center"
                                                       IsHitTestVisible="False"
                                                       Visibility="{Binding Text, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                        </Grid>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TextBox.Style>
            </TextBox>
            <Button Grid.Column="1" 
                    Content="âœ•" 
                    Foreground="Red"
                    FontWeight="Bold"
                    Width="30"
                    Height="30"
                    Margin="0,5,5,5"
                    Padding="0"
                    Click="ClearSearch_Click"
                    Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}}"/>
        </Grid>

        <!-- DataGrid Ñ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð°Ð¼Ð¸ -->
        <DataGrid Grid.Row="1"
                  x:Name="PropertiesDataGrid"
                  ItemsSource="{Binding Properties}"
                  AutoGenerateColumns="False"
                  HeadersVisibility="None"
                  GridLinesVisibility="All"
                  Background="White"
                  BorderThickness="0"
                  SelectionMode="Single"
                  SelectionUnit="Cell"
                  RowHeaderWidth="0"
                  VerticalGridLinesBrush="#E0E0E0"
                  HorizontalGridLinesBrush="#E0E0E0"
                  SelectionChanged="PropertiesDataGrid_SelectionChanged">
            <DataGrid.Style>
                <Style TargetType="DataGrid">
                    <Setter Property="RowStyle">
                        <Setter.Value>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Background" Value="White"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSectionHeader}" Value="True">
                                        <Setter Property="MinHeight" Value="20"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsSectionHeader}" Value="False">
                                        <Setter Property="MinHeight" Value="25"/>
                                    </DataTrigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F5F5F5"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="CellStyle">
                        <Setter.Value>
                            <Style TargetType="DataGridCell">
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Padding" Value="5,3"/>
                                <Setter Property="Background" Value="White"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                        <Setter Property="Foreground" Value="Black"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Setter.Value>
                    </Setter>
                </Style>
            </DataGrid.Style>
            <DataGrid.Columns>
                <!-- ÐšÐ¾Ð»Ð¾Ð½ÐºÐ° Ñ Ð¸ÐºÐ¾Ð½ÐºÐ°Ð¼Ð¸ Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÐµÐ¼ -->
                <DataGridTemplateColumn Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="5,0">
                                <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° ÑÐµÐºÑ†Ð¸Ð¸/ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð° (ÐºÐ»Ð¸ÐºÐ°Ð±ÐµÐ»ÑŒÐ½Ð°Ñ Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹) -->
                                <TextBlock x:Name="TriangleIcon"
                                           Text="{Binding IsExpanded, Converter={StaticResource ExpandedToTriangleConverter}}" 
                                           FontSize="10"
                                           VerticalAlignment="Center"
                                           Margin="0,0,5,0"
                                           Foreground="Black"
                                           Cursor="Hand"
                                           Visibility="{Binding IsSectionHeader, Converter={StaticResource BoolToVisibilityConverter}}"
                                           MouseDown="TriangleIcon_MouseDown"/>
                                <TextBlock Text=""
                                           FontSize="10"
                                           VerticalAlignment="Center"
                                           Margin="0,0,5,0"
                                           Visibility="{Binding IsSectionHeader, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Ð·Ð°Ð¼ÐºÐ° -->
                                <TextBlock Text="ðŸ”’" 
                                           FontSize="12"
                                           VerticalAlignment="Center"
                                           Margin="0,0,5,0"
                                           Visibility="{Binding IsLocked, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                                <TextBlock Text="C" 
                                           FontSize="10"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="0,0,5,0"
                                           Visibility="{Binding HasCategory, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ -->
                                <TextBlock Text="{Binding SectionName}" 
                                           FontWeight="{Binding IsSectionHeader, Converter={StaticResource BoolToFontWeightConverter}}"
                                           FontSize="{Binding IsSectionHeader, Converter={StaticResource BoolToFontSizeConverter}}"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsSectionHeader, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <StackPanel>
                                                <TextBlock Text="{Binding SectionName}" FontWeight="Bold" Margin="0,0,0,4"/>
                                                <TextBlock Text="{Binding Description}" TextWrapping="Wrap" MaxWidth="300"/>
                                            </StackPanel>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                                <TextBlock Text="{Binding PropertyName}" 
                                           FontWeight="Normal"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding IsSectionHeader, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <StackPanel>
                                                <TextBlock Text="{Binding PropertyName}" FontWeight="Bold" Margin="0,0,0,4"/>
                                                <TextBlock Text="{Binding Description}" TextWrapping="Wrap" MaxWidth="300"/>
                                            </StackPanel>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- ÐšÐ¾Ð»Ð¾Ð½ÐºÐ° ÑÐ¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÐµÐ¼ -->
                <DataGridTemplateColumn Width="*">
                    <DataGridTemplateColumn.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Background" Value="White"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTemplateColumn.CellStyle>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Margin="0">
                                <TextBlock Text="{Binding PropertyValue}" 
                                           VerticalAlignment="Center"
                                           Margin="5,0,5,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding IsSectionHeader}" Value="False"/>
                                                        <Condition Binding="{Binding IsEditable}" Value="False"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </MultiDataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBox Text="{Binding PropertyValue, UpdateSourceTrigger=LostFocus}"
                                         VerticalAlignment="Stretch"
                                         VerticalContentAlignment="Center"
                                         HorizontalAlignment="Stretch"
                                         Visibility="{Binding IsEditable, Converter={StaticResource BoolToVisibilityConverter}}"
                                         KeyDown="PropertyValueTextBox_KeyDown"
                                         LostFocus="PropertyValueTextBox_LostFocus"
                                         Margin="0"
                                         Padding="5,3">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="TextBox">
                                                        <Border x:Name="Border"
                                                                BorderBrush="Transparent" 
                                                                BorderThickness="1" 
                                                                Background="White"
                                                                CornerRadius="0">
                                                            <ScrollViewer x:Name="PART_ContentHost" 
                                                                          Margin="0"
                                                                          VerticalAlignment="Center"/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Border" Property="BorderBrush" Value="#0078D4"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                                <StackPanel Orientation="Horizontal" 
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Margin="5,0,5,0"
                                            Visibility="{Binding HasDropdown, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock Text="â–¼" FontSize="8"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>

